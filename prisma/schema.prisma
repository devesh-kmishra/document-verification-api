generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Candidate {
  id                 String   @id @default(uuid())
  name               String
  email              String   @unique
  phone              String?
  city               String?
  joiningDesignation String?
  createdAt          DateTime @default(now())

  employments EmploymentVerification[]
  notes       CandidateNote[]

  @@index([city])
  @@index([joiningDesignation])
  @@index([createdAt])
}

model CandidateNote {
  id          String    @id @default(uuid())
  candidateId String
  note        String
  createdBy   String?
  createdAt   DateTime  @default(now())
  candidate   Candidate @relation(fields: [candidateId], references: [id])
}

model EmploymentVerification {
  id                   String                @id @default(uuid())
  candidateId          String
  previousCompanyName  String
  previousCompanyEmail String
  designation          String
  tenureFrom           DateTime
  tenureTo             DateTime
  reasonForExit        String?
  hrContactName        String?
  hrContactPhone       String?
  status               VerificationStatus    @default(PENDING)
  verificationToken    String                @unique
  tokenExpiresAt       DateTime
  completedAt          DateTime?
  createdAt            DateTime              @default(now())
  candidate            Candidate             @relation(fields: [candidateId], references: [id])
  response             VerificationResponse?

  callingLogs CallingLog[]

  @@index([candidateId])
  @@index([status])
}

model VerificationResponse {
  id                       String                 @id @default(uuid())
  employmentVerificationId String                 @unique
  answers                  Json
  submittedAt              DateTime               @default(now())
  employmentVerification   EmploymentVerification @relation(fields: [employmentVerificationId], references: [id])
  documents                VerificationDocument[]
}

model CallingLog {
  id                       String                 @id @default(uuid())
  employmentVerificationId String
  callTime                 DateTime
  outcome                  String
  notes                    String?
  employmentVerification   EmploymentVerification @relation(fields: [employmentVerificationId], references: [id])
}

enum VerificationStatus {
  PENDING
  IN_PROGRESS
  CLEAR
  DISCREPANCY
  FAILED
}

model VerificationDocument {
  id         String               @id @default(uuid())
  responseId String
  type       DocumentType
  fileUrl    String
  uploadedAt DateTime             @default(now())
  response   VerificationResponse @relation(fields: [responseId], references: [id])
}

enum DocumentType {
  OFFER_LETTER
  RELIEVING_LETTER
}
